<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mehfil: The Poetry of India</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        heading: ['"Rozha One"', 'serif'],
                        body: ['"Karma"', 'serif'],
                    }
                }
            }
        }
    </script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Karma:wght@300;400;500;600;700&family=Rozha+One&display=swap" rel="stylesheet">

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* Custom Scrollbar hiding */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        /* Smooth transitions */
        body {
            transition: background-color 0.7s, color 0.7s;
        }
    </style>
</head>
<body class="bg-[#fffdf5] text-stone-800 font-body transition-colors duration-700">

    <!-- App Root -->
    <div id="app" class="min-h-screen flex flex-col">
        <!-- Content rendered by JS -->
    </div>

    <script>
        /* --- STATE MANAGEMENT --- */
        const state = {
            currentView: 'home', // home, write, profile, read
            darkMode: false,
            selectedPoem: null,
            filter: 'Sabhi',
            searchTerm: '',
            poems: [
                {
                    id: 1,
                    title: "Adhuri Dastaan / अधूरी दास्तां",
                    author: "Himanshu Soni",
                    content: "Kuch panne abhi bhi khali hain kitaab-e-zindagi ke,\nShayad tum aaoge to kahani puri hogi.\n\nRaaste wahi hain, bas manzil badal gayi hai,\nPehle tum thi, ab tumhari yaadein humsafar hain.\n\nकुछ पन्ने अभी भी खाली हैं किताब-ए-ज़िंदगी के,\nशायद तुम आओगे तो कहानी पूरी होगी।",
                    tags: ["Ishq", "Yaadein", "Modern"],
                    likes: 2450,
                    date: "Nov 2025"
                },
                {
                    id: 2,
                    title: "Hazaron Khwahishen / हज़ारों ख्वाहिशें",
                    author: "Mirza Ghalib",
                    content: "Hazaron khwahishen aisi ke har khwahish pe dam nikle,\nBohat niklay mere armaan, lekin phir bhi kam nikle.\n\nMohabbat mein nahin hai farq jeene aur marne ka,\nUsi ko dekh kar jeete hain jis kaafir pe dam nikle.\n\nहज़ारों ख्वाहिशें ऐसी कि हर ख्वाहिश पे दम निकले,\nबहुत निकले मेरे अरमान, लेकिन फिर भी कम निकले।",
                    tags: ["Classic", "Philosophy", "Ghalib"],
                    likes: 8992,
                    date: "1850"
                },
                {
                    id: 3,
                    title: "Koshish / कोशिश",
                    author: "Harivansh Rai Bachchan",
                    content: "Lehron se darkar nauka paar nahi hoti,\nKoshish karne walon ki kabhi haar nahi hoti.\n\nNanhi cheenti jab daana lekar chalti hai,\nChadhti deewaron par, sau baar fisalti hai.\n\nलहरों से डर कर नौका पार नहीं होती,\nकोशिश करने वालों की कभी हार नहीं होती।",
                    tags: ["Prerna", "Sahitya", "Classic"],
                    likes: 5100,
                    date: "1960"
                },
                {
                    id: 4,
                    title: "Sukoon / सुकून",
                    author: "Himanshu Soni",
                    content: "Suna hai shor bohot hai shehar mein tumhare,\nKabhi fursat mile to gaon ki shaam dekhna.\n\nWahan deewarein kachchi hain magar dil pakke hain,\nKisi roz wahan ka neela aasmaan dekhna.",
                    tags: ["Sukoon", "Gaon", "Zindagi"],
                    likes: 3200,
                    date: "2024"
                }
            ],
            categories: ["Sabhi", "Ishq", "Dard", "Prerna", "Sufi", "Sahitya"],
            aiAnalysis: null,
            translation: null,
            isAnalyzing: false,
            isTranslating: false,
            isGeneratingMuse: false,
            isCompletingVerse: false,
            writeForm: { title: '', content: '', tags: '' }
        };

        const apiKey = ""; // API Key provided at runtime

        /* --- API UTILITIES --- */
        async function callGemini(prompt) {
            try {
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] }),
                    }
                );
                if (!response.ok) throw new Error(`API Error: ${response.status}`);
                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || "Maaf karein, sampark toot gaya.";
            } catch (error) {
                console.error("Gemini API Error:", error);
                return "Sampark toot gaya hai. Kripya punah prayas karein.";
            }
        }

        /* --- RENDER FUNCTIONS --- */
        const app = document.getElementById('app');

        function render() {
            // Apply Theme Class
            if (state.darkMode) {
                document.documentElement.classList.add('dark');
                document.body.classList.add('bg-[#151210]', 'text-stone-200');
                document.body.classList.remove('bg-[#fffdf5]', 'text-stone-800');
            } else {
                document.documentElement.classList.remove('dark');
                document.body.classList.remove('bg-[#151210]', 'text-stone-200');
                document.body.classList.add('bg-[#fffdf5]', 'text-stone-800');
            }

            app.innerHTML = `
                ${Header()}
                <main class="flex-grow">
                    ${MainContent()}
                </main>
                ${Footer()}
            `;
            lucide.createIcons();
        }

        /* --- COMPONENTS --- */

        function Header() {
            const navClass = state.darkMode 
                ? 'bg-[#1a1614] border-[#3d342b] text-amber-50' 
                : 'bg-[#fffdf5] border-amber-200/60 text-stone-800';
            
            const activeBtnClass = state.darkMode ? 'bg-stone-800 text-amber-500' : 'bg-amber-100 text-rose-800';
            const inactiveBtnClass = state.darkMode ? 'text-stone-400 hover:text-amber-200' : 'text-stone-600 hover:text-rose-900';

            return `
                <nav class="sticky top-0 z-50 border-b shadow-sm transition-colors duration-500 ${navClass}">
                    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div class="flex justify-between items-center h-24">
                            <!-- Logo -->
                            <div onclick="setView('home')" class="flex items-center cursor-pointer space-x-4 group">
                                <div class="relative p-3 rounded-full border-2 transition-transform duration-700 group-hover:rotate-12 ${state.darkMode ? 'bg-stone-800 border-amber-600 text-amber-500' : 'bg-amber-50 border-amber-700 text-amber-800'}">
                                    <i data-lucide="feather" class="w-7 h-7"></i>
                                    <div class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full animate-pulse"></div>
                                </div>
                                <div class="flex flex-col">
                                    <h1 class="font-heading text-4xl tracking-wide leading-none flex gap-2 items-baseline">
                                        <span class="${state.darkMode ? 'text-amber-500' : 'text-amber-800'}">Mehfil</span>
                                        <span class="text-2xl font-light opacity-50">|</span>
                                        <span class="${state.darkMode ? 'text-rose-400' : 'text-rose-700'}">महफ़िल</span>
                                    </h1>
                                    <span class="text-[10px] font-bold uppercase tracking-[0.3em] mt-1 opacity-60">Designed by Himanshu</span>
                                </div>
                            </div>

                            <!-- Desktop Nav -->
                            <div class="hidden md:flex items-center space-x-8">
                                <button onclick="setView('home')" class="flex items-center space-x-2 px-4 py-2 rounded-full font-medium text-lg transition-all duration-300 ${state.currentView === 'home' ? activeBtnClass : inactiveBtnClass}">
                                    <i data-lucide="book-open" class="w-5 h-5"></i><span>Mehfil</span>
                                </button>
                                <button onclick="setView('write')" class="flex items-center space-x-2 px-4 py-2 rounded-full font-medium text-lg transition-all duration-300 ${state.currentView === 'write' ? activeBtnClass : inactiveBtnClass}">
                                    <i data-lucide="pen-tool" class="w-5 h-5"></i><span>Likho</span>
                                </button>
                                <button onclick="setView('profile')" class="flex items-center space-x-2 px-4 py-2 rounded-full font-medium text-lg transition-all duration-300 ${state.currentView === 'profile' ? activeBtnClass : inactiveBtnClass}">
                                    <i data-lucide="user" class="w-5 h-5"></i><span>Shayar</span>
                                </button>
                                <button onclick="toggleTheme()" class="p-3 rounded-full transition-colors border ${state.darkMode ? 'border-stone-700 hover:bg-stone-800 text-amber-400' : 'border-amber-200 hover:bg-amber-100 text-amber-800'}">
                                    <i data-lucide="${state.darkMode ? 'sun' : 'moon'}" class="w-5 h-5"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </nav>
            `;
        }

        function Footer() {
            const footerClass = state.darkMode ? 'bg-[#151210] border-stone-900 text-stone-600' : 'bg-[#fffdf5] border-amber-100 text-stone-500';
            return `
                <footer class="py-12 text-center border-t mt-auto ${footerClass}">
                    <div class="flex items-center justify-center space-x-3 mb-4 opacity-80">
                        <i data-lucide="feather" class="w-5 h-5"></i>
                        <span class="font-heading text-xl">Mehfil</span>
                    </div>
                    <p class="text-xs font-bold tracking-[0.2em] uppercase opacity-60">Designed with ❤️ by Himanshu</p>
                </footer>
            `;
        }

        function MainContent() {
            if (state.currentView === 'home') return HomeView();
            if (state.currentView === 'read') return ReadView();
            if (state.currentView === 'write') return WriteView();
            if (state.currentView === 'profile') return ProfileView();
            return '';
        }

        /* --- VIEWS --- */

        function HomeView() {
            const filtered = state.poems.filter(p => {
                const matchFilter = state.filter === 'Sabhi' || p.tags.includes(state.filter);
                const matchSearch = p.title.toLowerCase().includes(state.searchTerm.toLowerCase()) || 
                                    p.content.toLowerCase().includes(state.searchTerm.toLowerCase());
                return matchFilter && matchSearch;
            });

            return `
                <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
                    <!-- Hero -->
                    <section class="rounded-[2.5rem] p-10 md:p-20 mb-16 relative overflow-hidden shadow-2xl ${state.darkMode ? 'bg-[#1e1b19]' : 'bg-[#2c2420]'}">
                        <div class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1516280440614-6697288d5d38?q=80&w=2070&auto=format&fit=crop')] bg-cover bg-center opacity-20 mix-blend-overlay"></div>
                        <div class="relative z-10 max-w-4xl">
                            <span class="inline-block py-2 px-5 rounded-full text-[10px] font-bold tracking-[0.25em] mb-8 border ${state.darkMode ? 'bg-amber-500/10 text-amber-500 border-amber-500/20' : 'bg-amber-50/10 text-amber-200 border-amber-200/20'}">AAJ KA VICHAR</span>
                            <h1 class="font-heading text-4xl md:text-6xl lg:text-7xl mb-10 leading-tight text-white drop-shadow-lg">"Woh ishq hi kya jo aasaan ho, <br/>Woh dard hi kya jo bezuban ho."</h1>
                            <p class="text-xl md:text-2xl text-amber-100/80 mb-12 font-body italic font-light">— Himanshu Soni</p>
                            <button onclick="openReader(0)" class="px-10 py-4 rounded-xl font-bold tracking-widest transition-all shadow-lg bg-amber-600 text-white hover:bg-amber-700 hover:scale-105">Padhein (Read)</button>
                        </div>
                    </section>

                    <!-- Filters -->
                    <div class="flex flex-col md:flex-row md:items-center justify-between gap-8 mb-14">
                        <div class="flex items-center gap-3 overflow-x-auto pb-4 md:pb-0 no-scrollbar">
                            <i data-lucide="filter" class="w-5 h-5 opacity-50"></i>
                            ${state.categories.map(cat => `
                                <button onclick="setFilter('${cat}')" class="px-6 py-2.5 rounded-full text-sm font-bold tracking-wide whitespace-nowrap transition-all border ${state.filter === cat ? (state.darkMode ? 'bg-amber-700 text-white border-amber-700' : 'bg-rose-800 text-white border-rose-800 shadow-md') : (state.darkMode ? 'bg-[#1e1b19] text-stone-400 border-stone-800 hover:border-stone-600' : 'bg-white text-stone-600 border-amber-100 hover:border-amber-300')}">${cat}</button>
                            `).join('')}
                        </div>
                        <div class="relative w-full md:w-96">
                            <i data-lucide="search" class="absolute left-5 top-1/2 transform -translate-y-1/2 w-5 h-5 opacity-50"></i>
                            <input type="text" placeholder="Shayari dhoondein..." value="${state.searchTerm}" oninput="setSearch(this.value)" class="w-full pl-14 pr-6 py-3.5 rounded-full text-sm font-medium focus:outline-none focus:ring-2 transition-all shadow-sm ${state.darkMode ? 'bg-[#1e1b19] text-stone-200 placeholder-stone-600 focus:ring-amber-900/50 border border-stone-800' : 'bg-white text-stone-800 border border-amber-100 focus:ring-rose-200 focus:border-rose-300'}">
                        </div>
                    </div>

                    <!-- Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                        ${filtered.map(poem => PoemCard(poem)).join('')}
                    </div>
                    ${filtered.length === 0 ? `
                        <div class="text-center py-32 opacity-50">
                            <i data-lucide="scroll" class="mx-auto mb-6 w-16 h-16"></i>
                            <p class="font-heading text-3xl">Khamoshi...</p>
                            <p class="mt-3 text-lg">Koi shayari nahi mili.</p>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function PoemCard(poem) {
            return `
                <div onclick="openReader(${poem.id})" class="group cursor-pointer relative overflow-hidden rounded-2xl p-8 transition-all duration-500 hover:-translate-y-2 hover:shadow-2xl border ${state.darkMode ? 'bg-[#1e1b19] border-stone-800 hover:border-amber-700/50' : 'bg-white border-amber-100 hover:border-amber-300'}">
                    <div class="mb-6 relative z-10">
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-[10px] font-bold px-3 py-1 rounded-full uppercase tracking-[0.15em] border ${state.darkMode ? 'bg-[#2a2522] border-stone-700 text-amber-500' : 'bg-amber-50 border-amber-200 text-rose-800'}">${poem.tags[0]}</span>
                            <span class="text-xs opacity-60">${poem.date}</span>
                        </div>
                        <h3 class="font-heading text-2xl mb-3 leading-tight group-hover:text-amber-600 transition-colors">${poem.title}</h3>
                        <div class="flex items-center gap-3 mb-4">
                            <span class="w-8 h-[1px] ${state.darkMode ? 'bg-stone-700' : 'bg-amber-300'}"></span>
                            <p class="text-sm font-bold uppercase tracking-widest opacity-70">${poem.author}</p>
                        </div>
                    </div>
                    <div class="relative h-32 overflow-hidden mb-6 font-body text-lg leading-loose opacity-80">
                        <p class="whitespace-pre-line">${poem.content}</p>
                        <div class="absolute bottom-0 left-0 w-full h-20 bg-gradient-to-t ${state.darkMode ? 'from-[#1e1b19]' : 'from-white'} to-transparent"></div>
                    </div>
                    <div class="flex items-center justify-between pt-6 border-t border-dashed border-stone-300/20">
                        <div class="flex space-x-6 text-sm font-medium opacity-70">
                            <span class="flex items-center space-x-2 hover:text-rose-500"><i data-lucide="heart" class="w-4 h-4"></i> <span>${poem.likes}</span></span>
                        </div>
                        <span class="text-xs font-bold uppercase tracking-widest flex items-center gap-2 text-amber-600 group-hover:translate-x-1 transition-transform">
                            <span>Padhein</span> <i data-lucide="chevron-right" class="w-4 h-4"></i>
                        </span>
                    </div>
                </div>
            `;
        }

        function ReadView() {
            const poem = state.selectedPoem;
            if (!poem) return '';

            return `
                <div class="max-w-3xl mx-auto px-4 py-10">
                    <button onclick="setView('home')" class="mb-10 flex items-center space-x-2 text-xs font-bold uppercase tracking-[0.2em] opacity-60 hover:opacity-100 transition-opacity">
                        <i data-lucide="arrow-left" class="w-4 h-4"></i> <span>Wapas (Back)</span>
                    </button>

                    <article class="p-8 md:p-16 rounded-3xl shadow-2xl relative overflow-hidden border ${state.darkMode ? 'bg-[#1e1b19] border-stone-800' : 'bg-white border-amber-100'}">
                        <div class="absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r ${state.darkMode ? 'from-stone-800 via-amber-700 to-stone-800' : 'from-amber-200 via-rose-400 to-amber-200'}"></div>
                        
                        <header class="text-center mb-14">
                            <div class="flex justify-center gap-3 mb-8">
                                ${poem.tags.map(tag => `<span class="text-[10px] font-bold uppercase tracking-widest px-4 py-1.5 border rounded-full opacity-70 border-current">${tag}</span>`).join('')}
                            </div>
                            <h1 class="font-heading text-4xl md:text-5xl mb-6 leading-snug ${state.darkMode ? 'text-amber-50' : 'text-stone-900'}">${poem.title}</h1>
                            <div class="flex items-center justify-center space-x-4">
                                <span class="h-px w-16 bg-current opacity-30"></span>
                                <p class="text-lg font-medium ${state.darkMode ? 'text-amber-500' : 'text-rose-700'}">${poem.author}</p>
                                <span class="h-px w-16 bg-current opacity-30"></span>
                            </div>
                        </header>

                        <div class="relative mb-14 min-h-[180px]">
                            ${state.isTranslating ? `
                                <div class="flex flex-col items-center justify-center py-12 opacity-60">
                                    <i data-lucide="loader-2" class="w-8 h-8 animate-spin mb-3 text-amber-500"></i>
                                    <span class="text-sm">Anuvaad ho raha hai...</span>
                                </div>
                            ` : `
                                <div class="font-body text-2xl md:text-3xl leading-loose whitespace-pre-line text-center ${state.translation ? 'italic text-amber-600' : ''}">
                                    ${state.translation ? state.translation : poem.content}
                                </div>
                            `}
                        </div>

                        <!-- AI Tools -->
                        <div class="flex flex-col md:flex-row justify-center gap-4 mb-12 p-2 rounded-2xl ${state.darkMode ? 'bg-[#25211e]' : 'bg-stone-50'}">
                            <button onclick="handleTranslate()" class="flex items-center justify-center gap-2 px-6 py-3 rounded-xl text-xs font-bold uppercase tracking-wider transition-all ${state.translation ? 'bg-amber-100 text-amber-800' : 'opacity-60 hover:opacity-100'}">
                                <i data-lucide="languages" class="w-4 h-4"></i> ${state.translation ? 'Asli (Original)' : 'Tarjuma (Translate)'}
                            </button>
                            <div class="w-px bg-current opacity-10 hidden md:block"></div>
                            <button onclick="handleAnalyze()" ${state.isAnalyzing || state.aiAnalysis ? 'disabled' : ''} class="flex items-center justify-center gap-2 px-6 py-3 rounded-xl text-xs font-bold uppercase tracking-wider transition-all ${state.aiAnalysis ? 'bg-purple-100 text-purple-800' : 'opacity-60 hover:opacity-100'}">
                                ${state.isAnalyzing ? '<i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i>' : '<i data-lucide="sparkles" class="w-4 h-4"></i>'}
                                Gehrai (Analysis)
                            </button>
                        </div>

                        ${state.aiAnalysis ? `
                            <div class="mb-12 p-8 rounded-2xl border border-dashed border-purple-300 bg-purple-50/10">
                                <h3 class="font-bold text-xs uppercase tracking-[0.2em] mb-4 flex items-center gap-2 text-purple-500">
                                    <i data-lucide="brain" class="w-4 h-4"></i> Insight
                                </h3>
                                <div class="text-lg font-body leading-relaxed opacity-90">"${state.aiAnalysis}"</div>
                            </div>
                        ` : ''}
                    </article>
                </div>
            `;
        }

        function WriteView() {
            return `
                <div class="max-w-3xl mx-auto px-4 py-12">
                    <div class="mb-12 text-center">
                        <div class="inline-block p-3 rounded-full bg-amber-100 text-amber-600 mb-4 mx-auto"><i data-lucide="pen-tool" class="w-8 h-8"></i></div>
                        <h2 class="font-heading text-4xl mb-3">Kalam Aur Kagaz</h2>
                        <p class="text-lg opacity-60">Apne jazbaaton ko shabdon mein piroyein.</p>
                    </div>

                    <div class="p-8 md:p-12 rounded-3xl shadow-xl relative border ${state.darkMode ? 'bg-[#1e1b19] border-stone-700' : 'bg-white border-amber-200'}">
                        <button onclick="handleMuse()" ${state.isGeneratingMuse ? 'disabled' : ''} class="absolute top-6 right-6 z-10 flex items-center gap-2 px-4 py-2 rounded-full text-xs font-bold uppercase tracking-wider transition-all shadow-sm bg-amber-50 text-amber-900 border border-amber-200">
                            ${state.isGeneratingMuse ? '<i data-lucide="loader-2" class="w-3 h-3 animate-spin"></i>' : '<i data-lucide="sparkles" class="w-3 h-3"></i>'}
                            <span>${state.isGeneratingMuse ? 'Soch raha...' : 'Naya Khayal'}</span>
                        </button>

                        <div class="space-y-8 mt-6">
                            <div>
                                <label class="block text-xs font-bold uppercase tracking-[0.2em] mb-3 opacity-60">Unwaan (Title)</label>
                                <input type="text" value="${state.writeForm.title}" oninput="state.writeForm.title = this.value" placeholder="Shayari ka naam..." class="w-full text-3xl font-heading bg-transparent border-b-2 focus:outline-none pb-2 border-current opacity-80 focus:opacity-100 focus:border-amber-500">
                            </div>
                            <div>
                                <div class="flex justify-between items-center mb-4">
                                    <label class="block text-xs font-bold uppercase tracking-[0.2em] opacity-60">Shayari</label>
                                    <button onclick="handleCompleteVerse()" ${state.isCompletingVerse ? 'disabled' : ''} class="flex items-center gap-2 text-xs font-bold uppercase tracking-wider px-4 py-2 rounded-lg bg-indigo-50 text-indigo-700 hover:bg-indigo-100">
                                        ${state.isCompletingVerse ? '<i data-lucide="loader-2" class="w-3 h-3 animate-spin"></i>' : '<i data-lucide="wand-2" class="w-3 h-3"></i>'}
                                        Sher Pura Karein
                                    </button>
                                </div>
                                <div class="p-4 rounded-2xl border focus-within:ring-2 focus-within:ring-amber-500/20 ${state.darkMode ? 'bg-stone-900/50 border-stone-700' : 'bg-stone-50 border-stone-200'}">
                                    <textarea id="writeContent" oninput="state.writeForm.content = this.value" placeholder="Yahan likhein..." rows="8" class="w-full text-xl font-body leading-loose bg-transparent resize-y focus:outline-none">${state.writeForm.content}</textarea>
                                </div>
                            </div>
                            <div class="flex justify-end">
                                <button onclick="handlePublish()" class="px-10 py-4 rounded-xl font-bold tracking-wider shadow-lg flex items-center gap-2 bg-amber-600 text-white hover:bg-amber-700">
                                    <i data-lucide="feather" class="w-4 h-4"></i> Pesh Karein
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function ProfileView() {
            const myPoems = state.poems.filter(p => p.author === "Himanshu Soni");
            return `
                <div class="max-w-5xl mx-auto px-4 py-12">
                    <div class="p-10 md:p-16 rounded-[2rem] flex flex-col md:flex-row items-center gap-12 mb-16 shadow-xl border ${state.darkMode ? 'bg-[#1e1b19] border-stone-800' : 'bg-white border-amber-100'}">
                        <div class="w-48 h-48 rounded-full p-2 bg-gradient-to-tr from-amber-400 to-rose-600 shadow-2xl">
                            <div class="w-full h-full rounded-full flex items-center justify-center overflow-hidden bg-current text-stone-100">
                                <i data-lucide="user" class="w-16 h-16"></i>
                            </div>
                        </div>
                        <div class="text-center md:text-left flex-1">
                            <h2 class="text-5xl font-heading mb-2">Himanshu Soni</h2>
                            <p class="text-sm font-bold tracking-[0.2em] uppercase mb-6 text-rose-600">Mukhya Shayar</p>
                            <p class="font-body text-xl italic opacity-70">"Shabdon ki duniya mein ek musafir. Dil ki baat, kalam ke saath."</p>
                            <div class="flex justify-center md:justify-start gap-12 mt-10">
                                <div class="text-center">
                                    <span class="block text-3xl font-bold font-heading">${myPoems.length}</span>
                                    <span class="text-[10px] uppercase tracking-[0.2em] opacity-60 font-bold">Rachnayein</span>
                                </div>
                                <div class="text-center">
                                    <span class="block text-3xl font-bold font-heading">15.2K</span>
                                    <span class="text-[10px] uppercase tracking-[0.2em] opacity-60 font-bold">Chahne Wale</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center gap-4 mb-10">
                        <i data-lucide="coffee" class="w-6 h-6 text-amber-600"></i>
                        <h3 class="text-3xl font-heading">Meri Rachnayein</h3>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        ${myPoems.map(poem => PoemCard(poem)).join('')}
                    </div>
                </div>
            `;
        }

        /* --- ACTIONS --- */

        function setView(view) {
            state.currentView = view;
            // Reset temporary states
            state.translation = null;
            state.aiAnalysis = null;
            state.showTranslation = false;
            render();
        }

        function toggleTheme() {
            state.darkMode = !state.darkMode;
            render();
        }

        function setFilter(cat) {
            state.filter = cat;
            render();
        }

        function setSearch(val) {
            state.searchTerm = val;
            render();
        }

        function openReader(id) {
            // If ID is 0 (from hero), pick first poem
            const poemId = id === 0 ? state.poems[0].id : id;
            state.selectedPoem = state.poems.find(p => p.id === poemId);
            state.translation = null; 
            state.aiAnalysis = null;
            setView('read');
        }

        async function handleAnalyze() {
            state.isAnalyzing = true;
            render();
            const prompt = `Analyze this Hindi/Urdu poetry. Explain the 'Jazbaat' (emotions), 'Matlab' (meaning). Keep it soulful and concise (under 100 words). Poem: ${state.selectedPoem.content}`;
            const res = await callGemini(prompt);
            state.aiAnalysis = res;
            state.isAnalyzing = false;
            render();
        }

        async function handleTranslate() {
            // Toggle back to original if already translated
            if (state.translation) {
                state.translation = null;
                render();
                return;
            }
            state.isTranslating = true;
            render();
            const prompt = `Translate this Hindi poetry into simple, poetic English. Capture the essence. Poem: ${state.selectedPoem.content}`;
            const res = await callGemini(prompt);
            state.translation = res;
            state.isTranslating = false;
            render();
        }

        async function handleMuse() {
            state.isGeneratingMuse = true;
            render();
            const prompt = `Generate a short, poetic first line for a Hindi Shayari in Devanagari or Roman script. Theme: Love, Pain, or Life. Just the line.`;
            const res = await callGemini(prompt);
            const currentContent = state.writeForm.content;
            state.writeForm.content = currentContent ? `${currentContent}\n\n[Khayal: ${res}]` : `[Khayal: ${res}]\n\n`;
            state.isGeneratingMuse = false;
            render();
        }

        async function handleCompleteVerse() {
            const content = state.writeForm.content;
            if (!content) return;
            state.isCompletingVerse = true;
            render();
            const lines = content.trim().split('\n').filter(line => line.trim() !== '');
            const lastLine = lines[lines.length - 1];
            const prompt = `I wrote this line of Hindi poetry: "${lastLine}". Write a rhyming second line (Misra) to complete the couplet. Return ONLY the second line.`;
            const res = await callGemini(prompt);
            state.writeForm.content = content + "\n" + res;
            state.isCompletingVerse = false;
            render();
        }

        function handlePublish() {
            const { title, content } = state.writeForm;
            if(!title || !content) return alert("Kripya Unwaan aur Shayari likhein.");
            
            const newPoem = {
                id: state.poems.length + 1,
                title: title,
                author: "Himanshu Soni",
                content: content,
                tags: ["New", "Modern"],
                likes: 0,
                date: "Nov 2025"
            };
            
            state.poems.unshift(newPoem);
            state.writeForm = { title: '', content: '', tags: '' };
            setView('home');
        }

        // Initial Render
        render();

    </script>
</body>
</html>
